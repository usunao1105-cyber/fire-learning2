<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>消防職員向け 長周期地震動対策 e-Learning</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        h1, h2, h3, .serif {
            font-family: 'Noto Serif JP', serif;
        }
        
        /* Custom Colors based on "High Class" & Fire Dept theme */
        .bg-fire-dark { background-color: #1a202c; } /* Dark base */
        .bg-fire-red { background-color: #8B0000; } /* Deep Red */
        .text-fire-red { color: #8B0000; }
        .border-fire-red { border-color: #8B0000; }
        
        .bg-gold { background-color: #c5a059; } /* Muted Gold */
        .text-gold { color: #c5a059; }
        .border-gold { border-color: #c5a059; }

        .btn-primary {
            background: linear-gradient(135deg, #8B0000 0%, #600000 100%);
            color: white;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 0, 0, 0.3);
        }
        
        .card {
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-top: 4px solid #8B0000;
            transition: transform 0.2s;
        }
        
        .option-label {
            cursor: pointer;
            transition: all 0.2s;
        }
        .option-radio:checked + .option-content {
            background-color: #fff5f5;
            border-color: #8B0000;
            color: #8B0000;
            font-weight: bold;
        }
        
        /* Explanation Box Animation */
        .explanation-box {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, opacity 0.5s ease;
            opacity: 0;
        }
        .explanation-box.visible {
            max-height: 500px; /* Arbitrary large height */
            opacity: 1;
            margin-top: 1rem;
        }

        /* Result Badge */
        .badge-correct {
            background-color: #10B981;
            color: white;
        }
        .badge-incorrect {
            background-color: #EF4444;
            color: white;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-fire-dark text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i class="fa-solid fa-fire-extinguisher text-gold text-2xl"></i>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold tracking-wide">長周期地震動対策 e-Learning</h1>
                    <p class="text-xs text-gray-400">消防職員向け 特別教育資料</p>
                </div>
            </div>
            <div class="hidden md:block">
                <span class="text-gold serif italic">Professional Training Course</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-4xl">
        
        <!-- Intro / Welcome Section (Shown initially) -->
        <div id="intro-section" class="text-center py-12">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 serif">確認テストを開始します</h2>
            <p class="text-gray-600 mb-8 leading-relaxed">
                提供された資料に基づき、全50問の中からランダムに10問が出題されます。<br>
                自身の知識を確認し、業務に役立ててください。
            </p>
            <button onclick="startQuiz()" class="btn-primary px-8 py-4 rounded shadow-lg text-lg font-bold tracking-wider">
                テストを開始する
            </button>
        </div>

        <!-- Quiz Section (Hidden initially) -->
        <div id="quiz-section" class="hidden space-y-8">
            <!-- Questions will be injected here via JS -->
            <div id="questions-container"></div>

            <!-- Action Buttons -->
            <div class="text-center py-8">
                <button id="grade-btn" onclick="gradeQuiz()" class="btn-primary px-10 py-4 rounded shadow-lg text-xl font-bold tracking-wider w-full md:w-auto">
                    採点する
                </button>
            </div>
        </div>

        <!-- Result Modal / Overlay (Hidden initially) -->
        <div id="result-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-2xl max-w-lg w-full p-8 text-center border-t-8 border-gold transform transition-all scale-100">
                <h3 class="text-2xl serif font-bold text-gray-800 mb-2">採点結果</h3>
                <div class="text-6xl font-bold text-fire-red mb-4 serif">
                    <span id="score-display">0</span><span class="text-3xl text-gray-400">/100</span>
                </div>
                <p id="score-message" class="text-gray-600 mb-8">お疲れ様でした。解説を確認して復習しましょう。</p>
                <div class="flex flex-col space-y-3">
                    <button onclick="closeResultOverlay()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded transition">
                        解説を確認する
                    </button>
                    <button onclick="retryQuiz()" class="btn-primary py-3 px-6 rounded font-bold transition">
                        別の問題で再度挑戦する
                    </button>
                </div>
            </div>
        </div>

        <!-- Retry Button (Shown at bottom after grading) -->
        <div id="retry-section" class="hidden text-center py-12 border-t border-gray-300 mt-8">
            <p class="text-gray-600 mb-4">今回の学習は終了です。</p>
            <button onclick="retryQuiz()" class="bg-gray-800 hover:bg-gray-900 text-white px-8 py-4 rounded shadow-lg text-lg font-bold tracking-wider">
                <i class="fa-solid fa-rotate-right mr-2"></i> 再度挑戦する（新しい10問）
            </button>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 border-t border-gray-200 mt-12 py-6">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            &copy; 消防職員向け 長周期地震動対策 e-Learning System
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // ----------------------------------------------------
        // Data: 50 Questions Pool
        // ----------------------------------------------------
        // options array structure: [Option1, Option2, Option3, Option4]
        // answer index: 0-based index of the correct option
        const questionPool = [
            // 第1章
            {
                q: "長周期地震動の定義において、揺れが1往復するのにかかる時間を何と呼びますか？",
                options: ["振幅", "震度", "周期", "波長"],
                answer: 2,
                exp: "地震が起きると様々な周期を持つ揺れが発生しますが、揺れが1往復するのにかかる時間を「周期」と呼びます。"
            },
            {
                q: "長周期地震動が発生しやすい地震の主な特徴は何ですか？",
                options: ["震源が非常に浅い", "マグニチュード（地震の規模）が大きい", "発生時間が非常に短い", "短周期の波のみで構成される"],
                answer: 1,
                exp: "長周期地震動は、マグニチュードが大きい地震によって発生する「長くゆっくりとした大きな揺れ」です。"
            },
            {
                q: "長周期地震動が遠くまで伝わりやすい理由として正しいものはどれですか？",
                options: ["速度が非常に速いから", "重力の影響を受けないから", "短周期の揺れに比べて減衰しにくいから", "常に直線的に進むから"],
                answer: 2,
                exp: "長周期地震動は短周期の揺れに比べて減衰しにくいため、海の波のように震源から数百キロ離れた場所まで伝わる特性があります。"
            },
            {
                q: "日本の都市部において長周期地震動が増幅されやすい地質学的理由はどれですか？",
                options: ["火山岩が地表を覆っているため", "地盤が非常に硬いため", "厚くて柔らかい堆積層が存在するため", "海岸線が複雑だから"],
                answer: 2,
                exp: "平野や盆地には厚さ数kmにも達する柔らかい堆積層があり、そこに入射した地震波が表面波として発達・増幅されます。"
            },
            {
                q: "長周期地震動によって高層ビルが大きく揺れる現象を何と呼びますか？",
                options: ["散乱", "共振", "回折", "干渉"],
                answer: 1,
                exp: "地面の揺れの周期と建物固有の揺れ周期（固有周期）が一致すると、建物は共振して大きく揺れます。"
            },
            {
                q: "一般的な高層ビルの高さと固有周期の関係について、正しい記述はどれですか？",
                options: ["建物が低いほど周期は長い", "建物が高いほど周期は長い", "建物の高さと周期は無関係である", "周期は常に1秒以下である"],
                answer: 1,
                exp: "高層ビルの固有周期は建物の高さにおおむね比例し、高い建物ほどゆっくり揺れる（周期が長い）特性があります。"
            },
            {
                q: "免震構造の建物について、長周期地震動に対する性質として正しいものはどれですか？",
                options: ["短周期の揺れよりも長周期の揺れを低減しやすい", "固有周期が長いため、長周期地震動の影響を受けやすい", "どのような周期の揺れも完全に吸収する", "常に地面と全く同じ動きをする"],
                answer: 1,
                exp: "免震建物は地震動の短周期成分を避けるために長周期化されているため、長周期地震動とは共振しやすく、影響を受けやすい性質があります。"
            },
            {
                q: "長周期地震動の周期帯の一般的な範囲として、資料で言及されているのはどれですか？",
                options: ["0.1秒から0.5秒程度", "数秒から20秒程度", "1分から2分程度", "0.01秒以下"],
                answer: 1,
                exp: "長周期地震動は、大地震に特有の、周期数秒から20秒程度の揺れを指します。"
            },
            {
                q: "2003年十勝沖地震において、長周期地震動による被害が注目された都市はどこですか？",
                options: ["東京都", "大阪市", "苫小牧市", "仙台市"],
                answer: 2,
                exp: "2003年十勝沖地震では、震源から約250km離れた苫小牧市において石油タンク火災等の甚大な被害が発生し、注目を集めました。"
            },
            {
                q: "長周期地震動は、震度が小さくても大きな影響を及ぼすことがあります。その理由はどれですか？",
                options: ["震度計は長周期を計測できないから", "震度は地表面の揺れを基にしており、高層階の揺れを十分表現できないから", "常に津波を伴うから", "震度はマグニチュードと同じ意味だから"],
                answer: 1,
                exp: "震度は地表面付近の比較的短い揺れを対象とした指標であり、高層ビルの高層階における長周期の揺れを表現するには不十分です。"
            },
            // 第2章
            {
                q: "気象庁が導入した「長周期地震動階級」は何段階に区分されていますか？",
                options: ["3段階", "4段階", "7段階", "10段階"],
                answer: 1,
                exp: "気象庁は、高層ビル内での影響を評価するため、長周期地震動階級を1から4の4段階で設定しています。"
            },
            {
                q: "令和5年2月1日から、緊急地震速報（警報）が発表される基準に追加された条件はどれですか？",
                options: ["マグニチュード9.0以上を予想した場合", "長周期地震動階級3以上を予想した場合", "長周期地震動階級1以上を予想した場合", "震度4以上を予想した場合"],
                answer: 1,
                exp: "2023年（令和5年）2月1日から、従来の震度基準に加え、長周期地震動階級3以上を予想した場合にも緊急地震速報（警報）が発表される運用になりました。"
            },
            {
                q: "長周期地震動階級2の「人の体感・行動」として正しいものはどれですか？",
                options: ["ほとんどの人が揺れに気づかない", "物につかまりたいと感じる、行き足が乱れる", "立っていることが困難になる", "揺れに翻弄され、はわないと動けない"],
                answer: 1,
                exp: "階級2では室内で大きな揺れを感じ、物につかまりたいと感じるほか、行動に支障を感じます。"
            },
            {
                q: "長周期地震動階級4の「室内の状況」として適切な記述はどれですか？",
                options: ["ブラインドなどが大きく揺れる", "キャスター付き什器がわずかに動く", "固定していないほとんどの家具が移動・転倒する", "窓ガラスが全て割れる"],
                answer: 2,
                exp: "階級4は最も高い階級で、固定していないほとんどの家具が移動・転倒し、立っていることができなくなります。"
            },
            {
                q: "緊急地震速報において、震度によるものと長周期地震動によるものを区別せずに伝える理由はどれですか？",
                options: ["技術的に区別が不可能だから", "とるべき行動に大きな違いがなく、情報の猶予時間も限られるから", "どちらも同じ震度計で測るから", "全く同じ地域に発表されるから"],
                answer: 1,
                exp: "短周期でも長周期でも「身の安全を確保する」という基本行動は共通しており、猶予時間も短いため、区別せずに発表されます。"
            },
            {
                q: "長周期地震動階級を算出するために用いられる指標は何ですか？",
                options: ["最大地動加速度（PGA）", "絶対速度応答スペクトル（Sva）", "マグニチュード（M）", "震度階級値"],
                answer: 1,
                exp: "長周期地震動階級の評価には、建物の揺れの大きさを合理的に表現できる「絶対速度応答スペクトル（Sva）」が用いられます。"
            },
            {
                q: "長周期地震動階級1が予想された場合に発表される情報はどれですか？",
                options: ["緊急地震速報（警報）", "緊急地震速報（予報）", "地震動特別警報", "津波注意報"],
                answer: 1,
                exp: "長周期地震動階級1以上が予想された場合には「緊急地震速報（予報）」が発表されます。"
            },
            {
                q: "地震動特別警報が発表される条件の一つとして正しいものはどれですか？",
                options: ["震度5弱以上を予想", "長周期地震動階級4を予想", "長周期地震動階級2を予想", "マグニチュード7.0以上を予想"],
                answer: 1,
                exp: "最大震度6弱以上または長周期地震動階級4が予想された場合、地震動特別警報に位置付けられます。"
            },
            {
                q: "長周期地震動階級3において、建物自体に起こりうる被害はどれですか？",
                options: ["建物が完全に倒壊する", "間仕切壁などにひび割れや亀裂が入ることがある", "基礎杭が全て破断する", "地盤沈下が止まらなくなる"],
                answer: 1,
                exp: "階級3では、家具の転倒・移動に加え、間仕切壁などにひび割れや亀裂が入ることがあります。"
            },
            {
                q: "緊急地震速報（警報）の対象となる地域はどのような地域ですか？",
                options: ["日本全国", "階級1以上を予想した地域", "震度4以上または階級3以上を予想した地域", "過去に被害があった地域のみ"],
                answer: 2,
                exp: "警報の対象地域は、震度4以上または長周期地震動階級3以上を予想した地域です。"
            },
            // 第3章
            {
                q: "石油タンクにおける「スロッシング」現象の正しい説明はどれですか？",
                options: ["タンクの底板が抜ける現象", "地震波と内容液が共振して液面が大きく揺れる現象", "タンクが地面に沈み込む現象", "配管が凍結して破裂する現象"],
                answer: 1,
                exp: "スロッシングとは、地震動の周期とタンク内の液体の固有周期が一致し、液面が大きく揺動する現象です。"
            },
            {
                q: "2003年十勝沖地震での石油タンク被害の主な特徴は何ですか？",
                options: ["全ての固定屋根式タンクが爆発した", "シングルデッキ浮き屋根式タンクを中心に火災や沈没が発生した", "タンクの側板が全て溶けた", "被害は震源のすぐ近くのみに限定された"],
                answer: 1,
                exp: "甚大な被害（火災や浮き屋根の沈没）は、主にスロッシング固有周期が長いシングルデッキ浮き屋根式タンクで発生しました。"
            },
            {
                q: "苫小牧でのナフサタンク全面火災の直接的な出火原因と考えられているのはどれですか？",
                options: ["浮き屋根が沈没した後、露出した液面での消火泡による沈降帯電と放電", "タンクへの直接の落雷", "外部からの放火", "配管からのガス漏れによる自然発火"],
                answer: 0,
                exp: "沈没した浮き屋根の代わりに投入された消火泡が水溶液に戻り、沈降する際に帯電して放電が起こったことが原因と考えられています。"
            },
            {
                q: "スロッシングによる被害が発生する目安とされる最大波高は概ね何メートル以上ですか？",
                options: ["0.1メートル", "0.5メートル", "2メートル", "10メートル"],
                answer: 2,
                exp: "苫小牧の事例では、最大波高が概ね2メートル以上のタンクにおいて甚大な被害が発生していました。"
            },
            {
                q: "10万kl級の超大型タンクにおいて、1次モード以外に考慮すべき揺れは何ですか？",
                options: ["表面張力", "2次モードのスロッシング", "大気圧の変化", "周囲の風速"],
                answer: 1,
                exp: "超大型タンクでは2次モードの影響でデッキが大きく変形し、ポンツーンが破損する可能性があることが指摘されています。"
            },
            {
                q: "石油タンクのスロッシング対策として、まず最初に行うべき重要な管理は何ですか？",
                options: ["タンクの塗装", "液面管理（余裕空間の確保）", "タンクの清掃", "周囲の除草"],
                answer: 1,
                exp: "第1義的な対策としては、スロッシング波高が高くなっても溢れないよう適切な液面管理（余裕空間の確保）を行うことが重要です。"
            },
            {
                q: "浮き屋根式タンク（FRT）が原油等の貯蔵に多く用いられる主な理由は何ですか？",
                options: ["建設費用が最も安いから", "揮発損失を抑制でき、大型化が可能だから", "雨水の混入を完全に防げるから", "どのような地震にも耐えられるから"],
                answer: 1,
                exp: "浮き屋根式は直径の大きいタンクの建設が可能で、揮発損失を考慮する必要がある石油類の貯蔵に適しています。"
            },
            {
                q: "固定屋根式タンク（CRT）において、爆発時の影響を最小限にするための設計上の工夫は何ですか？",
                options: ["全体をコンクリートで固める", "屋根板と側板の接続部を最も弱く溶接し、屋根が吹き飛ぶようにする", "地中に埋める", "窓をたくさん作る"],
                answer: 1,
                exp: "万一爆発が発生した時に周囲への影響を最小限にとどめるため、屋根が吹き飛ぶ「放爆構造」に設計されています。"
            },
            {
                q: "スロッシングによって浮き屋根が沈没する主な原因は何ですか？",
                options: ["重油が重すぎるため", "タンクの底が抜けるため", "揺動により浮室（ポンツーン）やデッキ接合部が破断し、油が流入するため", "浮き屋根が蒸発するため"],
                answer: 2,
                exp: "液面の揺動に伴い浮き屋根が変形・破断し、浮室内に油が流入して浮力を保てなくなることで沈没に至ります。"
            },
            {
                q: "1964年新潟地震でのタンク火災の教訓から改善された技術基準はどれですか？",
                options: ["タンクの色の指定", "シールの材質など衝撃火花が発生しにくい構造への変更", "タンクの高さ制限", "消防署の配置場所"],
                answer: 1,
                exp: "当時はシール機構が金属製で衝撃火花が出やすかったため、現在の基準に適合したタンクでは着火危険性が低減されています。"
            },
            // 第4章
            {
                q: "長周期地震動によるエレベーターの主な被害事例はどれですか？",
                options: ["籠（かご）が床に激突する", "メインロープやケーブルが共振し、昇降路内の突起物に引っかかる", "全てのボタンが同時に押される", "電気が永久に止まる"],
                answer: 1,
                exp: "長いロープが地震動と共振して大きく振れ、レールブラケット等の突起物に引っかかって断線や閉じ込めが発生します。"
            },
            {
                q: "エレベーターの長周期地震動対策として有効なハード対策はどれですか？",
                options: ["籠の鏡を大きくする", "引っかかり防止対策（プロテクタの設置等）や長周期センサーの整備", "速度を2倍にする", "扉を木製にする"],
                answer: 1,
                exp: "ロープの引っかかりを防止する器具の設置や、揺れを検知して制御する長周期センサーの導入が進められています。"
            },
            {
                q: "免震構造の基本原理として、アイソレーターの主な役割は何ですか？",
                options: ["揺れを完全に止める", "建物の固有周期を長くし、地震入力を低減する", "建物に重りを付ける", "建物を地面に固定する"],
                answer: 1,
                exp: "アイソレーターを用いて建物を柔らかく支持することで、固有周期を長くし、地震力を低減させます（アイソレーター機能）。"
            },
            {
                q: "免震建物の長周期地震動対策における「衝突」の問題とは何ですか？",
                options: ["近隣の建物同士がぶつかる", "免震層の変位が大きくなり、上部建物が周囲の擁壁に衝突する", "籠とエレベーターホールがぶつかる", "家具が天井にぶつかる"],
                answer: 1,
                exp: "長周期地震動により免震層が大変形し、水平クリアランス（隙間）を超えて擁壁に衝突する危険があります。"
            },
            {
                q: "長周期地震動に対して、ダンパーに求められる性能は何ですか？",
                options: ["全く変形しないこと", "長時間繰り返される変形でも性能低下せず、エネルギーを吸収し続けること", "常に一定の温度を保つこと", "磁力で揺れを抑えること"],
                answer: 1,
                exp: "長周期地震動は継続時間が長いため、長時間の繰り返し変形による金属疲労や温度上昇に耐える性能が求められます。"
            },
            {
                q: "アクティブ制震（能動的制御）の仕組みとして正しいものはどれですか？",
                options: ["常に固定しておく", "地震計で揺れをモニターし、コンピュータが命令を出して振動を打ち消す力を発生させる", "重い壁を増設する", "自然に揺れが止まるのを待つ"],
                answer: 1,
                exp: "外部からの情報や建物の応答をモニターし、制御装置で能動的に地震動を制御します。"
            },
            {
                q: "高層ビルの高層階において、震度情報だけでは被害を想像しにくい理由はどれですか？",
                options: ["高層階には震度計がないから", "低層階にある管理センターでは、自身の体感（震度相当）以上の揺れを想像しにくいから", "常に霧が出ていて見えないから", "震度計は1階にしか置いてはいけないから"],
                answer: 1,
                exp: "低層階では発表された震度程度の揺れしか体感しないため、高層階で発生している激しい揺れや被害を察知しにくい傾向があります。"
            },
            {
                q: "パッシブ制震（受動的制御）の特徴として正しいものはどれですか？",
                options: ["外部から電力を供給して動かす", "装置の特性が固定されており、地震の途中で変わらない", "人が手動で操作する", "常に風の力で動かす"],
                answer: 1,
                exp: "パッシブ制震は、装置の特性が固定されており、地震エネルギーを吸収する構造です。"
            },
            {
                q: "長周期地震動によるエレベーターの閉じ込め事故を防ぐための運用上の注意はどれですか？",
                options: ["地震が起きたらすぐに最上階へ向かう", "揺れを感じたら全ての階のボタンを押し、停止した階ですぐに降りる", "籠の中でジャンプする", "扉を中から無理やり開ける"],
                answer: 1,
                exp: "地震発生時には、直ちに全ての階のボタンを押し、停止した階で速やかに降車することが基本原則です。"
            },
            {
                q: "昇降機（エレベーター）の管理者が地震後に点検を行う際の共通の課題は何ですか？",
                options: ["階段が使えないこと", "地下や1階の管理室にいるため、高層階での長周期地震動の影響を予測しにくいこと", "常に暗闇で作業すること", "工具が重すぎること"],
                answer: 1,
                exp: "管理者が低層階に常駐している場合、長周期地震動による上層階の状況を把握しにくいという課題があります。"
            },
            // 第5章
            {
                q: "地震による負傷者の原因のうち、家具類の転倒・落下・移動が占める割合は概ねどれくらいですか？",
                options: ["5％以下", "10％程度", "3割から5割", "9割以上"],
                answer: 2,
                exp: "東京消防庁の調査によれば、負傷原因の3割から5割を家具類の転倒・落下・移動が占めています。"
            },
            {
                q: "長周期地震動における家具の挙動として、従来の地震対策に加えて特に警戒すべき点はどれですか？",
                options: ["家具が溶けること", "背の低い家具でも大きく「移動」し、凶器となること", "家具が静かに浮き上がること", "家具の色が変わること"],
                answer: 1,
                exp: "大きくゆっくりした揺れにより、キャスター付きの什器や背の低い家具が数メートルも「移動」する危険があります。"
            },
            {
                q: "家具の転倒・落下防止器具の中で、最も効果が高いとされているものはどれですか？",
                options: ["ストッパー式（単独）", "マット式（単独）", "L型金具（ボルト固定）", "ポール式（単独）"],
                answer: 2,
                exp: "ネジやボルトで壁や床に直接固定するL型金具が最も高い効果を示します。"
            },
            {
                q: "ポール式（つっぱり棒）を設置する際の注意点として正しいものはどれですか？",
                options: ["天井のどこに設置しても良い", "天井の強度を確認し、ストッパー式や粘着マット式と併用する", "緩めに設置する", "1本だけ設置すれば十分である"],
                answer: 1,
                exp: "ポール式は天井の強度が重要であり、ストッパー式等と組み合わせることで効果が高まります。"
            },
            {
                q: "オフィスのレイアウト設計において、避難経路の幅は最低何メートル確保すべきですか？",
                options: ["0.5メートル", "1.2メートル", "2.0メートル", "5.0メートル"],
                answer: 1,
                exp: "避難路の確保のため、1.2メートル以上の通路幅を維持することが推奨されています。"
            },
            {
                q: "病院の地震対策における「5つの原則」に含まれないものはどれですか？",
                options: ["動かさないものは固定する", "キャスターは原則固定する", "高層階の患者を全員1階へ移す", "安定した形状・バランスにする"],
                answer: 2,
                exp: "病院の地震対策5原則は、固定、安定、バランス、キャスターの原則固定などです。"
            },
            {
                q: "緊急地震速報を見聞きした際、高層ビル内での安全行動として正しいものはどれですか？",
                options: ["あわてて非常階段へ駆け出す", "エレベーターで1階へ向かう", "物が「落ちてこない・倒れてこない・移動してこない」場所へ身を寄せる", "窓から外を確認する"],
                answer: 2,
                exp: "揺れに翻弄されないよう姿勢を低くし、頭部を保護しながら安全なスペースへ退避します。"
            },
            {
                q: "長周期地震動による不安感の増大を防ぐために、最も重要とされることは何ですか？",
                options: ["長周期地震動の特性を事前に「知っておくこと」", "常に耳栓をしておくこと", "地震の時は目をつむること", "建物からすぐに飛び出す訓練をすること"],
                answer: 0,
                exp: "未知の揺れに対する不安を低減するためには、事前に知識を得て、体感しておくことが有効です。"
            },
            {
                q: "地震直後の行動ルールとして、高層階で推奨される負傷者の把握方法はどれですか？",
                options: ["全員が1階に降りて報告する", "階層ごとにあらかじめ定めた安全なスペースに集合し、安否を確認する", "消防隊が来るまで何もしない", "大声で叫び続ける"],
                answer: 1,
                exp: "エレベーター停止による孤立を防ぐため、階層ごとのコミュニティで迅速に安否確認を行うことが重要です。"
            },
            {
                q: "高層階において、救護の到着に時間がかかることを想定して備えるべきものはどれですか？",
                options: ["最新の大型テレビ", "応急救護用品や常用電源によらないラジオ・照明", "折り畳み自転車", "豪華な非常食"],
                answer: 1,
                exp: "救助に時間を要するため、各階層ごとに応急救護セットや情報収集のためのラジオ、懐中電灯を備える必要があります。"
            }
        ];

        // ----------------------------------------------------
        // Logic
        // ----------------------------------------------------
        let currentQuestions = [];
        let userAnswers = {}; // { questionIndex: selectedOptionIndex }
        let isGraded = false;

        function startQuiz() {
            // Pick 10 random questions
            const shuffled = [...questionPool].sort(() => 0.5 - Math.random());
            currentQuestions = shuffled.slice(0, 10);
            
            // Reset state
            userAnswers = {};
            isGraded = false;

            // Render
            renderQuestions();
            
            // Switch view
            document.getElementById('intro-section').classList.add('hidden');
            document.getElementById('quiz-section').classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        function renderQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';

            currentQuestions.forEach((q, index) => {
                const qNum = index + 1;
                
                // Card HTML
                const card = document.createElement('div');
                card.className = 'card rounded-lg p-6 relative';
                card.id = `q-card-${index}`;

                let optionsHtml = '';
                q.options.forEach((opt, i) => {
                    optionsHtml += `
                        <label class="block mb-2 option-label group">
                            <input type="radio" name="q${index}" value="${i}" class="hidden option-radio" onchange="selectAnswer(${index}, ${i})" ${isGraded ? 'disabled' : ''}>
                            <div class="option-content border border-gray-200 rounded p-3 text-gray-700 hover:bg-gray-50 group-hover:border-gray-400 flex items-center">
                                <span class="w-6 h-6 rounded-full border border-gray-300 flex items-center justify-center mr-3 text-xs font-bold option-marker bg-white text-gray-500">
                                    ${String.fromCharCode(65 + i)}
                                </span>
                                <span>${opt}</span>
                            </div>
                        </label>
                    `;
                });

                card.innerHTML = `
                    <div class="mb-4">
                        <span class="inline-block bg-gray-200 text-gray-700 text-xs font-bold px-2 py-1 rounded mb-2">Q${qNum}</span>
                        <h3 class="text-lg font-bold text-gray-900">${q.q}</h3>
                    </div>
                    <div class="space-y-2">
                        ${optionsHtml}
                    </div>
                    <!-- Result & Explanation Area (Hidden initially) -->
                    <div id="result-${index}" class="explanation-box bg-gray-50 rounded mt-4 p-4 border-l-4 border-gray-300 text-sm">
                        <!-- Content injected via JS on grade -->
                    </div>
                `;
                
                container.appendChild(card);
            });
            
            // Show grade button, hide retry section
            document.getElementById('grade-btn').classList.remove('hidden');
            document.getElementById('retry-section').classList.add('hidden');
        }

        function selectAnswer(questionIndex, optionIndex) {
            if (isGraded) return;
            userAnswers[questionIndex] = optionIndex;
        }

        function gradeQuiz() {
            // Check if all answered? (Optional, let's allow partial grading but warn if needed. For now, strict grading not required by prompt, just "grade")
            if (Object.keys(userAnswers).length < currentQuestions.length) {
                if(!confirm("未回答の問題がありますが、採点しますか？")) return;
            }

            let score = 0;
            isGraded = true;

            currentQuestions.forEach((q, index) => {
                const userChoice = userAnswers[index];
                const isCorrect = (userChoice === q.answer);
                if (isCorrect) score += 10;

                // Update UI for this card
                const resultBox = document.getElementById(`result-${index}`);
                const card = document.getElementById(`q-card-${index}`);
                
                // Color Code inputs
                const inputs = document.getElementsByName(`q${index}`);
                inputs.forEach((input, i) => {
                    input.disabled = true;
                    const contentDiv = input.nextElementSibling;
                    const marker = contentDiv.querySelector('.option-marker');
                    
                    if (i === q.answer) {
                        // Correct Answer Style
                        contentDiv.classList.add('bg-green-50', 'border-green-500', 'text-green-800');
                        marker.classList.add('bg-green-500', 'text-white', 'border-green-500');
                        marker.innerHTML = '<i class="fas fa-check"></i>';
                    } else if (i === userChoice && !isCorrect) {
                        // User Wrong Answer Style
                        contentDiv.classList.add('bg-red-50', 'border-red-500', 'text-red-800');
                        marker.classList.add('bg-red-500', 'text-white', 'border-red-500');
                        marker.innerHTML = '<i class="fas fa-times"></i>';
                    }
                });

                // Set Explanation Content
                const statusHtml = isCorrect 
                    ? '<span class="badge-correct text-xs px-2 py-1 rounded font-bold mb-2 inline-block">正解</span>' 
                    : '<span class="badge-incorrect text-xs px-2 py-1 rounded font-bold mb-2 inline-block">不正解</span>';
                
                resultBox.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-grow">
                            ${statusHtml}
                            <p class="font-bold text-gray-800 mb-1">【正解】${q.options[q.answer]}</p>
                            <p class="text-gray-600 leading-relaxed"><span class="font-bold text-fire-red">解説：</span>${q.exp}</p>
                        </div>
                    </div>
                `;
                
                // Show explanation
                resultBox.classList.add('visible');
                resultBox.style.borderColor = isCorrect ? '#10B981' : '#EF4444';
            });

            // Show Overlay with Score
            const scoreDisplay = document.getElementById('score-display');
            const scoreMessage = document.getElementById('score-message');
            scoreDisplay.textContent = score;

            if (score === 100) {
                scoreMessage.textContent = "素晴らしい！全問正解です。知識は完璧です。";
                scoreMessage.className = "text-gold font-bold mb-8";
            } else if (score >= 80) {
                scoreMessage.textContent = "合格ラインです。間違えた箇所を確認しましょう。";
            } else {
                scoreMessage.textContent = "復習が必要です。解説をよく読んで再挑戦してください。";
            }

            document.getElementById('result-overlay').classList.remove('hidden');
            document.getElementById('result-overlay').classList.add('flex');

            // Hide Grade Button, Show Retry Section
            document.getElementById('grade-btn').classList.add('hidden');
            document.getElementById('retry-section').classList.remove('hidden');
            
            // Scroll to top to ensure overlay is nice, or just stay put.
        }

        function closeResultOverlay() {
            document.getElementById('result-overlay').classList.add('hidden');
            document.getElementById('result-overlay').classList.remove('flex');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function retryQuiz() {
            closeResultOverlay();
            startQuiz();
        }
    </script>
</body>
</html>
