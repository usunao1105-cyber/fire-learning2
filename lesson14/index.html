<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>育成指導記録システム</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel (for JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* カスタムスクロールバーなどの微調整 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c4b5fd; /* 薄い紫 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a78bfa; 
        }
        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-image: linear-gradient(to bottom right, #f5f3ff, #eef2ff); /* 背景にうっすらグラデーション */
            min-height: 100vh;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        .animate-fade-in {
            animation: fadeIn 0.2s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Icons (SVG Components) ---
        const IconBase = ({ children, className = "w-4 h-4" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const SaveIcon = (props) => <IconBase {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></IconBase>;
        const UserIcon = (props) => <IconBase {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></IconBase>;
        const FileTextIcon = (props) => <IconBase {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></IconBase>;
        const DownloadIcon = (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></IconBase>;
        const Trash2Icon = (props) => <IconBase {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></IconBase>;
        const AlertCircleIcon = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></IconBase>;
        const Edit3Icon = (props) => <IconBase {...props}><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></IconBase>;
        const XIcon = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconBase>;
        const CheckIcon = (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12"></polyline></IconBase>;
        const RefreshCwIcon = (props) => <IconBase {...props}><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></IconBase>;

        // --- Constants & Config ---
        const FISCAL_MONTHS = [
            { value: 4, label: '4月' }, { value: 5, label: '5月' }, { value: 6, label: '6月' },
            { value: 7, label: '7月' }, { value: 8, label: '8月' }, { value: 9, label: '9月' },
            { value: 10, label: '10月' }, { value: 11, label: '11月' }, { value: 12, label: '12月' },
            { value: 1, label: '1月' }, { value: 2, label: '2月' }, { value: 3, label: '3月' },
        ];

        const RATINGS = [
            { value: 'S', label: 'S : 特に優秀', color: 'text-indigo-700', bg: 'bg-indigo-50 border-indigo-200', requireComment: true },
            { value: 'A', label: 'A : 優秀', color: 'text-emerald-700', bg: 'bg-emerald-50 border-emerald-200', requireComment: true },
            { value: 'B', label: 'B : 普通', color: 'text-slate-600', bg: 'bg-slate-50 border-slate-200', requireComment: false },
            { value: 'C', label: 'C : 要指導/改善', color: 'text-rose-700', bg: 'bg-rose-50 border-rose-200', requireComment: true },
        ];

        // 職員データの初期構造を関数で定義（ディープコピー用）
        const getInitialEmployees = () => Array.from({ length: 20 }, (_, i) => ({
            id: `emp-${i + 1}`,
            name: `職員 ${String(i + 1).padStart(2, '0')}`,
            staffId: `${1000 + i + 1}`,
            rank: '主事'
        }));

        // --- Helper Functions ---
        const getFiscalYear = () => {
            const today = new Date();
            return today.getMonth() < 3 ? today.getFullYear() - 1 : today.getFullYear();
        };

        const formatDate = (dateStr) => {
            if (!dateStr) return '';
            const d = new Date(dateStr);
            return `${d.getFullYear()}年${d.getMonth() + 1}月${d.getDate()}日`;
        };

        // --- Components ---
        const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false, title = '' }) => {
            // 気品あるボタンデザイン：グラデーションとシャドウを使用
            const baseStyle = "px-4 py-2 rounded-lg font-bold transition-all duration-200 flex items-center justify-center gap-2 cursor-pointer shadow-sm transform active:scale-95";
            const variants = {
                primary: "bg-gradient-to-r from-violet-600 to-indigo-600 hover:from-violet-700 hover:to-indigo-700 text-white shadow-indigo-200 hover:shadow-indigo-300",
                secondary: "bg-white text-indigo-700 border border-indigo-200 hover:bg-indigo-50 hover:border-indigo-300 hover:text-indigo-800",
                danger: "bg-white text-rose-600 border border-rose-200 hover:bg-rose-50 hover:text-rose-700",
                outline: "border border-slate-300 text-slate-700 hover:bg-slate-50",
                ghost: "bg-transparent hover:bg-indigo-50 text-slate-500 hover:text-indigo-600",
            };
            return (
                <button 
                    onClick={onClick} 
                    disabled={disabled}
                    className={`${baseStyle} ${variants[variant]} ${className} ${disabled ? 'opacity-50 cursor-not-allowed grayscale' : ''}`}
                    title={title}
                >
                    {children}
                </button>
            );
        };

        // --- Main Application ---
        function App() {
            // State
            const [currentYear, setCurrentYear] = useState(getFiscalYear());
            const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth() + 1);
            const [selectedEmployeeId, setSelectedEmployeeId] = useState(getInitialEmployees()[0].id);
            const [employees, setEmployees] = useState(getInitialEmployees());
            
            // Edit State for Employees
            const [editingId, setEditingId] = useState(null);
            const [editForm, setEditForm] = useState({ name: "", staffId: "", rank: "" });
            
            // Delete Confirm State
            const [deletingRecordId, setDeletingRecordId] = useState(null);

            // Reset Modal State
            const [isResetModalOpen, setIsResetModalOpen] = useState(false);

            // Data Store
            const [records, setRecords] = useState({});
            
            // Form State
            const [formData, setFormData] = useState({
                date: new Date().toISOString().split('T')[0],
                rating: 'B',
                comment: ''
            });
            const [formError, setFormError] = useState('');

            // Initial Load
            useEffect(() => {
                const savedRecords = localStorage.getItem('training_records_v1');
                const savedEmployees = localStorage.getItem('training_employees_v1');
                if (savedRecords) setRecords(JSON.parse(savedRecords));
                if (savedEmployees) setEmployees(JSON.parse(savedEmployees));
            }, []);

            // Save on Change
            useEffect(() => {
                localStorage.setItem('training_records_v1', JSON.stringify(records));
            }, [records]);

            // Save Employees on Change
            useEffect(() => {
                localStorage.setItem('training_employees_v1', JSON.stringify(employees));
            }, [employees]);

            // Derived State
            const currentRecords = useMemo(() => {
                return Object.values(records)
                    .filter(r => r.employeeId === selectedEmployeeId && r.month === selectedMonth && r.year === currentYear)
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
            }, [records, selectedEmployeeId, selectedMonth, currentYear]);

            const selectedEmployee = employees.find(e => e.id === selectedEmployeeId);

            // Handlers
            const handleRatingChange = (e) => {
                setFormData({ ...formData, rating: e.target.value });
                setFormError('');
            };

            const handleCommentChange = (e) => {
                setFormData({ ...formData, comment: e.target.value });
                setFormError('');
            };

            const validateForm = () => {
                const ratingConfig = RATINGS.find(r => r.value === formData.rating);
                if (!formData.date) return "日付を入力してください。";
                if (ratingConfig?.requireComment && !formData.comment.trim()) {
                    return "この評価を選択した場合、コメント（指導内容・事実）の入力は必須です。";
                }
                return null;
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                const error = validateForm();
                if (error) {
                    setFormError(error);
                    return;
                }

                const newRecord = {
                    id: Date.now().toString(),
                    employeeId: selectedEmployeeId,
                    year: currentYear,
                    month: selectedMonth,
                    date: formData.date,
                    rating: formData.rating,
                    comment: formData.comment,
                    createdAt: new Date().toISOString()
                };

                setRecords(prev => ({ ...prev, [newRecord.id]: newRecord }));
                setFormData(prev => ({ ...prev, rating: 'B', comment: '' }));
                setFormError('');
            };

            const handleDeleteRequest = (id) => {
                setDeletingRecordId(id);
                setTimeout(() => {
                    setDeletingRecordId(prev => prev === id ? null : prev);
                }, 3000);
            };

            const handleDeleteConfirm = (id) => {
                setRecords(prev => {
                    const next = { ...prev };
                    delete next[id];
                    return next;
                });
                setDeletingRecordId(null);
            };

            // Employee Editing Logic
            const startEditing = (e, emp) => {
                e.stopPropagation();
                setEditingId(emp.id);
                // 既存の値または初期値をセット
                setEditForm({
                    name: emp.name,
                    staffId: emp.staffId || "",
                    rank: emp.rank || ""
                });
            };

            const cancelEditing = (e) => {
                e.stopPropagation();
                setEditingId(null);
                setEditForm({ name: "", staffId: "", rank: "" });
            };

            const saveEditing = (e) => {
                e.stopPropagation();
                if (editingId && editForm.name.trim()) {
                    setEmployees(prev => prev.map(emp => 
                        emp.id === editingId ? { 
                            ...emp, 
                            name: editForm.name.trim(),
                            staffId: editForm.staffId.trim(),
                            rank: editForm.rank.trim()
                        } : emp
                    ));
                }
                setEditingId(null);
            };

            const handleExportCSV = () => {
                let csvContent = "data:text/csv;charset=utf-8,";
                // ヘッダーに職員番号、階級を追加
                csvContent += "年度,月,職員番号,階級,職員名,日付,評価,コメント\n";

                Object.values(records).forEach(r => {
                    const emp = employees.find(e => e.id === r.employeeId);
                    const empName = emp?.name || '不明';
                    const empStaffId = emp?.staffId || '';
                    const empRank = emp?.rank || '';
                    const ratingLabel = RATINGS.find(rt => rt.value === r.rating)?.label || r.rating;
                    const safeComment = `"${r.comment.replace(/"/g, '""')}"`;
                    
                    csvContent += `${r.year},${r.month},${empStaffId},${empRank},${empName},${r.date},${ratingLabel},${safeComment}\n`;
                });

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `育成指導記録_${currentYear}年度.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            // 全体リセット機能 (モーダル実行)
            const executeReset = () => {
                localStorage.removeItem('training_records_v1');
                localStorage.removeItem('training_employees_v1');
                
                // State初期化
                setRecords({});
                setEmployees(getInitialEmployees());
                setFormData({
                    date: new Date().toISOString().split('T')[0],
                    rating: 'B',
                    comment: ''
                });
                
                setIsResetModalOpen(false);
            };

            const isCommentRequired = RATINGS.find(r => r.value === formData.rating)?.requireComment;

            return (
                <div className="min-h-screen font-sans pb-12">
                    {/* Header with Fancy Gradient */}
                    <header className="bg-gradient-to-r from-indigo-900 via-purple-900 to-pink-900 text-white shadow-lg relative z-10">
                        <div className="absolute inset-0 bg-white opacity-5" style={{backgroundImage: 'radial-gradient(circle at 2px 2px, white 1px, transparent 0)', backgroundSize: '24px 24px'}}></div>
                        <div className="max-w-7xl mx-auto px-4 py-5 flex justify-between items-center relative z-20">
                            <div className="flex items-center gap-3">
                                <div className="bg-white/20 backdrop-blur-sm p-2.5 rounded-xl shadow-inner border border-white/20">
                                    <FileTextIcon className="w-6 h-6 text-white" />
                                </div>
                                <div>
                                    <h1 className="text-2xl font-bold tracking-tight text-white drop-shadow-sm" style={{fontFamily: '"Hiragino Mincho ProN", "Yu Mincho", serif'}}>育成指導記録システム</h1>
                                    <p className="text-xs text-indigo-200 mt-0.5 font-light tracking-wide">MANAGEMENT & DEVELOPMENT RECORD</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <Button variant="secondary" onClick={handleExportCSV} className="text-sm shadow-none !bg-white/90 !text-indigo-900 !border-none hover:!bg-white">
                                    <DownloadIcon className="w-4 h-4" /> CSV出力
                                </Button>
                                <Button variant="danger" onClick={() => setIsResetModalOpen(true)} className="text-sm !bg-rose-500/20 !text-rose-100 !border-rose-400/30 hover:!bg-rose-500/40" title="初期化">
                                    <RefreshCwIcon className="w-4 h-4" />
                                </Button>
                            </div>
                        </div>
                    </header>

                    {/* Reset Confirmation Modal */}
                    {isResetModalOpen && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in">
                            <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 space-y-4 transform scale-100 transition-all border border-rose-100">
                                <h3 className="text-lg font-bold text-rose-700 flex items-center gap-2 border-b border-rose-100 pb-3">
                                    <AlertCircleIcon className="w-6 h-6" /> システム初期化の確認
                                </h3>
                                <div className="text-slate-600 space-y-3 text-sm pt-2">
                                    <p className="font-bold">保存されているデータをすべて削除し、初期状態に戻します。</p>
                                    <ul className="list-disc pl-5 space-y-1 bg-rose-50 p-4 rounded-xl text-rose-800 border border-rose-100">
                                        <li>すべての育成指導記録が消去されます</li>
                                        <li>職員の名前・番号・階級の変更も元に戻ります</li>
                                        <li><strong>この操作は取り消せません</strong></li>
                                    </ul>
                                </div>
                                <div className="flex justify-end gap-3 pt-4">
                                    <Button variant="ghost" onClick={() => setIsResetModalOpen(false)}>
                                        キャンセル
                                    </Button>
                                    <button onClick={executeReset} className="px-4 py-2 rounded-lg font-bold bg-rose-600 text-white hover:bg-rose-700 shadow-md shadow-rose-200 transition-all">
                                        初期化を実行する
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="max-w-7xl mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-4 gap-8">
                        
                        {/* Left Column: Staff List */}
                        <div className="lg:col-span-1 glass-panel rounded-2xl shadow-xl border border-white/50 overflow-hidden flex flex-col h-[calc(100vh-160px)]">
                            <div className="p-5 border-b border-indigo-50 bg-gradient-to-br from-white to-indigo-50/50">
                                <h2 className="font-bold text-indigo-900 flex items-center gap-2 text-lg">
                                    <UserIcon className="w-5 h-5 text-indigo-600" /> 職員一覧 <span className="text-sm font-normal text-slate-500 bg-white px-2 py-0.5 rounded-full shadow-sm ml-auto">{employees.length}名</span>
                                </h2>
                            </div>
                            <div className="overflow-y-auto flex-1 p-3 space-y-2">
                                {employees.map(emp => {
                                    const count = Object.values(records).filter(r => 
                                        r.employeeId === emp.id && r.month === selectedMonth && r.year === currentYear
                                    ).length;
                                    
                                    const isSelected = selectedEmployeeId === emp.id;
                                    const isEditing = editingId === emp.id;

                                    // 編集モード時の表示
                                    if (isEditing) {
                                        return (
                                            <div key={emp.id} className="bg-white border-2 border-indigo-300 rounded-xl p-4 space-y-3 shadow-lg z-10 relative">
                                                <div>
                                                    <label className="text-xs text-indigo-500 font-bold block mb-1">氏名</label>
                                                    <input 
                                                        autoFocus
                                                        type="text"
                                                        value={editForm.name}
                                                        onChange={(e) => setEditForm({...editForm, name: e.target.value})}
                                                        className="w-full border-slate-300 rounded-md px-2 py-1.5 text-sm outline-none focus:border-indigo-500 ring-2 ring-transparent focus:ring-indigo-100 transition-all bg-slate-50"
                                                        placeholder="職員名"
                                                    />
                                                </div>
                                                <div className="flex gap-2">
                                                    <div className="w-1/2">
                                                        <label className="text-xs text-indigo-500 font-bold block mb-1">職員番号</label>
                                                        <input 
                                                            type="text"
                                                            value={editForm.staffId}
                                                            onChange={(e) => setEditForm({...editForm, staffId: e.target.value})}
                                                            className="w-full border-slate-300 rounded-md px-2 py-1.5 text-sm outline-none focus:border-indigo-500 bg-slate-50"
                                                            placeholder="番号"
                                                        />
                                                    </div>
                                                    <div className="w-1/2">
                                                        <label className="text-xs text-indigo-500 font-bold block mb-1">階級</label>
                                                        <input 
                                                            type="text"
                                                            value={editForm.rank}
                                                            onChange={(e) => setEditForm({...editForm, rank: e.target.value})}
                                                            className="w-full border-slate-300 rounded-md px-2 py-1.5 text-sm outline-none focus:border-indigo-500 bg-slate-50"
                                                            placeholder="階級"
                                                        />
                                                    </div>
                                                </div>
                                                <div className="flex justify-end gap-2 pt-2 border-t border-slate-100">
                                                    <button onClick={cancelEditing} className="px-3 py-1.5 text-xs font-bold text-slate-500 hover:bg-slate-100 rounded-md transition-colors">キャンセル</button>
                                                    <button onClick={saveEditing} className="px-3 py-1.5 text-xs font-bold bg-indigo-600 text-white rounded-md hover:bg-indigo-700 shadow-sm flex items-center gap-1">
                                                        <SaveIcon className="w-3 h-3" /> 保存
                                                    </button>
                                                </div>
                                            </div>
                                        );
                                    }

                                    // 通常表示モード
                                    return (
                                        <div 
                                            key={emp.id}
                                            className={`group flex items-start justify-between w-full px-4 py-3.5 rounded-xl text-sm transition-all border cursor-pointer relative overflow-hidden ${
                                                isSelected 
                                                    ? 'bg-gradient-to-r from-violet-50 to-indigo-50 text-indigo-900 border-indigo-200 shadow-md transform scale-[1.01]' 
                                                    : 'bg-white/80 hover:bg-white text-slate-600 border-transparent hover:shadow-sm hover:border-indigo-100'
                                            }`}
                                            onClick={() => setSelectedEmployeeId(emp.id)}
                                        >
                                            {isSelected && <div className="absolute left-0 top-0 bottom-0 w-1 bg-indigo-500"></div>}
                                            <div className="flex items-center gap-3 flex-1 overflow-hidden">
                                                <div className={`w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center text-xs font-bold shadow-sm transition-all text-white ${
                                                    isSelected 
                                                        ? 'bg-gradient-to-br from-violet-500 to-indigo-600 ring-2 ring-indigo-200' 
                                                        : 'bg-gradient-to-br from-slate-400 to-slate-500'
                                                }`}>
                                                    {emp.name.slice(0, 2)}
                                                </div>
                                                <div className="flex flex-col overflow-hidden">
                                                    <span className={`truncate font-bold text-base ${isSelected ? 'text-indigo-900' : 'text-slate-700'}`}>{emp.name}</span>
                                                    <span className={`text-[10px] truncate uppercase tracking-wider ${isSelected ? 'text-indigo-500' : 'text-slate-400'}`}>
                                                        ID.{emp.staffId || '-'} <span className="mx-1">|</span> {emp.rank || '-'}
                                                    </span>
                                                </div>
                                            </div>

                                            <div className="flex items-center gap-1 flex-shrink-0 ml-2">
                                                {count > 0 && (
                                                    <span className={`text-[10px] font-bold px-2 py-0.5 rounded-full ${
                                                        isSelected ? 'bg-indigo-200 text-indigo-800' : 'bg-slate-200 text-slate-600'
                                                    }`}>
                                                        {count}
                                                    </span>
                                                )}
                                                <button
                                                    onClick={(e) => startEditing(e, emp)}
                                                    className="p-2 text-slate-300 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-all"
                                                    title="編集"
                                                >
                                                    <Edit3Icon className="w-4 h-4" />
                                                </button>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* Right Column: Main Content */}
                        <div className="lg:col-span-3 space-y-8">
                            
                            {/* Month Selector */}
                            <div className="glass-panel rounded-2xl shadow-sm border border-white/60 p-3 overflow-x-auto">
                                <div className="flex min-w-max space-x-2">
                                    {FISCAL_MONTHS.map(month => (
                                        <button
                                            key={month.value}
                                            onClick={() => setSelectedMonth(month.value)}
                                            className={`px-5 py-2.5 rounded-xl text-sm font-bold transition-all whitespace-nowrap ${
                                                selectedMonth === month.value
                                                    ? 'bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-md shadow-indigo-200 transform scale-105'
                                                    : 'text-slate-500 hover:bg-indigo-50 hover:text-indigo-600'
                                            }`}
                                        >
                                            {month.label}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Input Form */}
                            <div className="glass-panel rounded-2xl shadow-xl border border-white/60 p-8 relative overflow-hidden">
                                <div className="absolute top-0 right-0 w-32 h-32 bg-indigo-100 rounded-full mix-blend-multiply filter blur-2xl opacity-50 -translate-y-1/2 translate-x-1/2"></div>
                                
                                <div className="flex items-center justify-between mb-6 relative z-10">
                                    <h3 className="font-bold text-xl text-indigo-950 flex items-center gap-3">
                                        <div className="flex flex-col items-start">
                                            <span className="bg-indigo-100 text-indigo-800 px-4 py-1 rounded-full text-sm font-bold shadow-sm mb-1">{selectedEmployee?.name}</span>
                                        </div>
                                        <span className="text-slate-300 font-light">|</span>
                                        <span className="text-lg font-medium text-slate-600">{selectedMonth}月期 記録入力</span>
                                    </h3>
                                </div>

                                <form onSubmit={handleSubmit} className="space-y-6 relative z-10">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="block text-sm font-bold text-indigo-900 mb-2">指導・確認日 <span className="text-rose-400">*</span></label>
                                            <input
                                                type="date"
                                                required
                                                value={formData.date}
                                                onChange={(e) => setFormData({...formData, date: e.target.value})}
                                                className="w-full border-slate-300 rounded-xl shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 border p-3 bg-white/80 transition-all"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-bold text-indigo-900 mb-2">評価ランク <span className="text-rose-400">*</span></label>
                                            <select
                                                value={formData.rating}
                                                onChange={handleRatingChange}
                                                className="w-full border-slate-300 rounded-xl shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 border p-3 bg-white/80 transition-all font-medium"
                                            >
                                                {RATINGS.map(r => (
                                                    <option key={r.value} value={r.value}>{r.label}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-bold text-indigo-900 mb-2">
                                            コメント / 指導内容 
                                            {isCommentRequired 
                                                ? <span className="ml-3 text-[10px] text-rose-600 font-bold bg-rose-50 px-2 py-0.5 rounded-full border border-rose-100">必須</span>
                                                : <span className="ml-3 text-[10px] text-slate-400 font-normal">任意</span>
                                            }
                                        </label>
                                        <textarea
                                            value={formData.comment}
                                            onChange={handleCommentChange}
                                            rows={3}
                                            placeholder={isCommentRequired ? "具体的な行動事実、指導した内容、改善点などを入力してください。" : "特記事項があれば入力してください。"}
                                            className={`w-full rounded-xl shadow-sm border p-4 transition-all focus:ring-2 focus:ring-opacity-50 ${
                                                isCommentRequired && !formData.comment.trim() 
                                                    ? 'border-rose-300 focus:border-rose-500 focus:ring-rose-200 bg-rose-50/50' 
                                                    : 'border-slate-300 focus:border-indigo-500 focus:ring-indigo-200 bg-white/80'
                                            }`}
                                        />
                                        {formError && (
                                            <p className="mt-2 text-sm text-rose-600 flex items-center gap-1 font-bold animate-pulse">
                                                <AlertCircleIcon className="w-4 h-4" /> {formError}
                                            </p>
                                        )}
                                    </div>

                                    <div className="flex justify-end pt-2">
                                        <Button type="submit" className="px-8 py-3 shadow-lg shadow-indigo-200">
                                            <SaveIcon className="w-5 h-5" /> 記録を保存
                                        </Button>
                                    </div>
                                </form>
                            </div>

                            {/* Records List */}
                            <div className="glass-panel rounded-2xl shadow-xl border border-white/60 overflow-hidden">
                                <div className="p-5 border-b border-indigo-50 bg-gradient-to-r from-white to-indigo-50/30 flex justify-between items-center">
                                    <h3 className="font-bold text-indigo-900 flex items-center gap-2">
                                        <FileTextIcon className="w-5 h-5 text-indigo-400" />
                                        登録済み記録 <span className="text-sm font-normal text-slate-500">({currentRecords.length})</span>
                                    </h3>
                                </div>
                                
                                {currentRecords.length === 0 ? (
                                    <div className="p-12 text-center text-slate-300 flex flex-col items-center">
                                        <div className="bg-slate-50 p-4 rounded-full mb-3 shadow-inner">
                                            <FileTextIcon className="w-8 h-8" />
                                        </div>
                                        <p className="font-medium text-slate-400">記録はまだありません</p>
                                        <p className="text-xs mt-1">上のフォームから入力を開始してください</p>
                                    </div>
                                ) : (
                                    <div className="divide-y divide-slate-100">
                                        {currentRecords.map(record => {
                                            const rConfig = RATINGS.find(r => r.value === record.rating);
                                            const isDeleting = deletingRecordId === record.id;
                                            
                                            return (
                                                <div key={record.id} className="p-6 hover:bg-white transition-colors group relative">
                                                    <div className="flex justify-between items-start mb-3">
                                                        <div className="flex items-center gap-4">
                                                            <span className="text-sm font-bold text-slate-500 bg-slate-100 px-3 py-1 rounded-lg shadow-sm border border-slate-200">
                                                                {formatDate(record.date)}
                                                            </span>
                                                            <span className={`text-sm font-bold px-4 py-1 rounded-full border shadow-sm ${rConfig?.bg} ${rConfig?.color}`}>
                                                                {rConfig?.label}
                                                            </span>
                                                        </div>
                                                        
                                                        {isDeleting ? (
                                                            <div className="flex items-center gap-3 animate-fade-in bg-rose-50 px-3 py-1 rounded-full border border-rose-100">
                                                                <span className="text-xs text-rose-600 font-bold">削除しますか？</span>
                                                                <button 
                                                                    onClick={() => handleDeleteConfirm(record.id)}
                                                                    className="bg-rose-500 text-white px-3 py-1 rounded-full text-xs font-bold hover:bg-rose-600 shadow-sm"
                                                                >
                                                                    はい
                                                                </button>
                                                                <button 
                                                                    onClick={() => setDeletingRecordId(null)}
                                                                    className="bg-white text-slate-600 border border-slate-200 px-3 py-1 rounded-full text-xs hover:bg-slate-50"
                                                                >
                                                                    いいえ
                                                                </button>
                                                            </div>
                                                        ) : (
                                                            <button 
                                                                onClick={() => handleDeleteRequest(record.id)}
                                                                className="text-slate-300 hover:text-rose-500 hover:bg-rose-50 rounded-full p-2 transition-all"
                                                                title="削除"
                                                            >
                                                                <Trash2Icon className="w-4 h-4" />
                                                            </button>
                                                        )}
                                                    </div>
                                                    <p className="text-sm text-slate-700 whitespace-pre-wrap leading-relaxed pl-1">
                                                        {record.comment || <span className="text-slate-300 italic">コメントなし</span>}
                                                    </p>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>

                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
